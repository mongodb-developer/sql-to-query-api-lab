import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# üëê $sort and $limit

## üîπ $sort ‚Üí Sorting results

### Syntax

```js
{
  $sort: {
    field: 1,
  }
}
```

- `{ field: 1 }` ‚Üí **Ascending order** (A ‚Üí Z, smallest to largest)
- `{ field: -1 }` ‚Üí **Descending order** (Z ‚Üí A, largest to smallest)
- You can sort by multiple fields, just like SQL.

### Example: Find the most recent reviews on our app.

```js
db.reviews.aggregate([
  {
    $sort: { timestamp: -1 },
  },
]);
```

### **Equivalent SQL query**

```sql
SELECT * FROM books ORDER BY timestamp DESC;
```

---

## üîπ $limit ‚Üí Limiting the number of results

### Syntax

```json
{
  $limit: n
}
```

- n is the maximum number of documents you want in your results.

### Example: Find the 5 most recent reviews on our app

```js
db.reviews.aggregate([
  {
    $sort: { timestamp: -1 },
  },
  {
    $limit: 5,
  },
]);
```

### **Equivalent SQL query**

```sql
SELECT * FROM books ORDER BY timestamp DESC LIMIT 5;
```

---

## üëê Challenge

### üëê 1. After the year 2000, which book has the most number of authors?

<details>
  <summary>Answer</summary>
  <div>
  There are 2 ways to solve this-
  - $project
  - $addFields

:::info
Learn [when to use $addFields over $project](https://www.practical-mongodb-aggregations.com/guides/project.html?highlight=%24project#when-to-use-project)
:::

  <Tabs groupId="aggregations" defaultValue="js">
    <TabItem value="js" label="JavaScript">
      <Tabs groupId="js-inner" defaultValue="project">
        <TabItem value="project" label="Using $project">
          ```js
          await books.aggregate([
          {
            $match: { year: { $gt: 2000 } }
          },
          {
            $match: {
              authors: { $exists: true }
            }
          },
          {
            $project: {
              title: 1,
              year: 1,
              authors: 1,
              numAuthors: { $size: "$authors" }
            }
          },
          {
            $sort: { numAuthors: -1 }
          },
          {
            $limit: 1
          }
        ]).toArray();
          ```
        </TabItem>

        <TabItem value="addFields" label="Using $addFields">
          ```js
          await books.aggregate([
            {
              $match: { year: { $gt: 2000 } }
            },
            {
              $match: {
                authors: { $exists: true },
              }
            },
            {
              $addFields: {
                numAuthors: { $size: "$authors" },
              }
            },
            {
              $sort: { "numAuthors": -1 }
            },
            {
              $limit: 1
            }
          ]).toArray();
          ```
        </TabItem>
      </Tabs>
    </TabItem>

    <TabItem value="csharp" label="C#">
      <Tabs groupId="aggregations-csharp" defaultValue="addFields">
        <TabItem value="project" label="Using $project">
          <div>
          ```csharp
          var pipeline = booksCollection.Aggregate()
            .Match(b => b.Year > 2000)
            .Match(Builders<Book>.Filter.Exists(b => b.Authors))
            .Project(new BsonDocument
            {
                { "title", 1 },
                { "year", 1 },
                { "authors", 1 },
                { "numAuthors", new BsonDocument("$size", "$authors") }
            })
            .Sort(new BsonDocument("numAuthors", -1))
            .Limit(1);

          var mostAuthors = await pipeline.ToListAsync();
        ```
          </div>
        </TabItem>

        <TabItem value="addFields" label="Using $addFields">
          <div>
          ```csharp
          var pipeline = booksCollection.Aggregate()
            .Match(b => b.Year > 2000)
            .Match(Builders<Book>.Filter.Exists(b => b.Authors))
            .AppendStage<BsonDocument>(
              new BsonDocument("$addFields",
                new BsonDocument("numAuthors", new BsonDocument("$size", "$authors"))
              )
            )
            .Sort(new BsonDocument("numAuthors", -1))
            .Limit(1);

        var mostAuthors = pipeline.ToList();
        ```
          </div>
        </TabItem>
      </Tabs>
    </TabItem>
    <TabItem value="python" label="Python">
      <Tabs groupId="aggregations-python" defaultValue="addFields">
        <TabItem value="project" label="Using $project">
          <div>
            ```python
            most_authors = books.aggregate
            ([
              {
                "$match": {
                  "year": { "$gt": 2000 },
                  "authors": { "$exists": True }
                }
              },
              {
                "$project": {
                  "title": 1,
                  "year": 1,
                  "authors": 1,
                  "numAuthors": { "$size": "$authors" }
                }
              },
              { "$sort": { "numAuthors": -1 } },
              { "$limit": 1 }
            ])

            for book in most_authors:
              print(book)
            ```
          </div>
        </TabItem>

        <TabItem value="addFields" label="Using $addFields">
          <div>
            ```python
            most_authors = books.aggregate
            ([
              {
                "$match": 
                { "year": { "$gt": 2000 } },
                { "authors": { "$exists": True } }
              },
              {
                "$addFields": {
                  "numAuthors": { "$size": "$authors" }
                }
              },
              { "$sort": { "numAuthors": -1 } },
              { "$limit": 1 }
            ])

            for book in most_authors:
              print(book)
            ```
          </div>
        </TabItem>
      </Tabs>
    </TabItem>
  </Tabs>
  </div>
</details>
